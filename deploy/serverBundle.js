!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=46)}({0:function(e,t){e.exports=require("crypto")},1:function(e,t,n){"use strict";n.d(t,"c",function(){return u}),n.d(t,"a",function(){return b}),n.d(t,"f",function(){return p}),n.d(t,"d",function(){return d}),n.d(t,"e",function(){return f}),n.d(t,"b",function(){return i});var a=n(0),s=n.n(a),r=n(2);const o="aes-256-cbc",i="ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff",d=new(n.n(r).a)({b:2048}),c=d.exportKey("public"),f={serKey:c,selfSig:d.sign(c)};function u(e,t){const n=JSON.stringify(e),a=s.a.randomBytes(16),r=s.a.createCipheriv(o,t,a);let i=r.update(n,"utf8","hex");return[i+=r.final("hex"),a.toString("hex")]}function b(e,t,n){const a=s.a.createDecipheriv(o,t,Buffer.from(n,"hex"));let r=a.update(e,"hex","utf8");return r+=a.final("utf8"),JSON.parse(r)}function p(e){const t=s.a.createHash("sha256");return t.update(e),t.digest()}},10:function(e){e.exports={DHTAddress:"0xb79Db8F22222c91efA355308423CccF5a37Ca6Cc",ganacheAccounts:["0x98d9579E87645A0bEf00F46cC7117e8420700Aa2","0xAb67ddCF85805A6162572106766d6341EA5dC1C9","0x9606ce1eC0Fd5F069e1c6E4CFEd179bC808a6Be4","0x127F854bd61Dd34718C9A2E6fCb5e4D14f1eFD26","0x3F377De5475795Ef23bFD33D1043B71A6aB40106","0x09524f985819664Fbaa50FB00DE72749c0e0094E","0x32D69cf326146615b186F2aEf9221fcFA98AC0E5","0xf7bD84A692Ec075D07274AA5fDf2aBf6658b8868","0xE23D068190735824255A55761c2AB096d4E78422","0xd17d6F1c8B0D8c95Ef84cD1e84BaB7e9E94B7Ead"]}},11:function(e){e.exports=[{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor",signature:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"nodeAddress",type:"address"},{indexed:!1,name:"pubKey",type:"bytes32"},{indexed:!1,name:"certificate",type:"bytes32"},{indexed:!1,name:"ip",type:"bytes32"},{indexed:!1,name:"port",type:"uint256"},{indexed:!1,name:"nonce",type:"uint256"},{indexed:!1,name:"numNodes",type:"uint256"}],name:"Onboard",type:"event",signature:"0xdfb851cffc58e1d5f9cd9ff58756f6040d7c2ecc59367601dc9be0aec897090d"},{anonymous:!1,inputs:[{indexed:!1,name:"nodeAddress",type:"address"}],name:"SafeOffboard",type:"event",signature:"0x56da62cb14075047178cff31184be899129b83506fb0b1fe540a31b94fc2ec33"},{anonymous:!1,inputs:[{indexed:!1,name:"nodeAddress",type:"address"}],name:"OffboardPoll",type:"event",signature:"0x0f6edb819eb25f1e80b8ac7d740ea1be6bd22ac0ed6f6551966ffb6e0eb92d72"},{constant:!1,inputs:[{name:"inputBytes",type:"bytes"},{name:"inputSig",type:"bytes"}],name:"startOnboard",outputs:[],payable:!0,stateMutability:"payable",type:"function",signature:"0x99879ef8"},{constant:!1,inputs:[],name:"finalizeOnboard",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function",signature:"0x94c9c8f5"},{constant:!1,inputs:[],name:"safeOffboard",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function",signature:"0x65ac9b0a"},{constant:!1,inputs:[{name:"nodeAddress",type:"address"}],name:"beginOffboardVote",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function",signature:"0x3de4a2ec"},{constant:!1,inputs:[{name:"nodeAddress",type:"address"},{name:"remove",type:"bool"}],name:"offboardVote",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function",signature:"0x3fd53565"},{constant:!1,inputs:[{name:"nodeAddress",type:"address"}],name:"finalizeOffboardVote",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function",signature:"0xca523ce7"},{constant:!0,inputs:[{name:"nodeAddress",type:"address"}],name:"getNodeState",outputs:[{name:"",type:"address"},{name:"",type:"bytes32"},{name:"",type:"bytes32"},{name:"",type:"bytes32"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function",signature:"0x229bb823"},{constant:!0,inputs:[{name:"index",type:"uint256"}],name:"getNodeAddressByIndex",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function",signature:"0xe8263c40"},{constant:!0,inputs:[],name:"getNumNodes",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function",signature:"0x62bc2ffa"}]},2:function(e,t){e.exports=require("node-rsa")},20:function(e,t){e.exports=require("express")},21:function(e,t){e.exports=require("http")},25:function(e,t){e.exports=require("socket.io")},46:function(e,t,n){"use strict";n.r(t);var a=n(20),s=n.n(a),r=n(21),o=n.n(r),i=n(2),d=n.n(i),c=n(0),f=n.n(c),u=n(1);n(7);const b=Object({NODE_ENV:"production"}).PORT||8080,p=s()(),l=o.a.createServer(p);(function(e,t,a){let s=n(25)(e);console.log("Connecting Socket I/O"),s.on("connection",e=>{console.log("Client connected.");let n={state:"ServerPubKeyBroadcast"};e.emit("ServerPubKeyBroadcast",a),e.on("ClientPubKeyBroadcast",a=>{if("ServerPubKeyBroadcast"!==n.state||"Closed"===n.state)return void(n.state="Closed");const s=new d.a(a.serKey);if(!s.verify(a.serKey,a.selfSig))return void(n.state="Closed");n.clientKey=s,n.state="ServerEDHBroadcast",n.dhParams=f.a.createDiffieHellman(u.b,"hex");const r=JSON.stringify({serverDHPubKey:n.dhParams.generateKeys("hex")}),o=n.clientKey.encrypt(r),i=t.sign(o);e.emit("ServerEDHBroadcast",{encSerDHParams:o,sig:i})}),e.on("ClientEDHBroadcast",a=>{if("ServerEDHBroadcast"!==n.state||"Closed"===n.state)return void(n.state="Closed");if(!n.clientKey.verify(a.encSerDHParams,a.sig))return void(n.state="Closed");const s=JSON.parse(t.decrypt(a.encSerDHParams)).clientDHPubKey;n.dhKey=n.dhParams.computeSecret(s,"hex","hex"),n.aesKey=Object(u.f)(n.dhKey),console.log("Finishing secure handshake with client."),n.state="Open",e.emit("ServerACK",{})}),e.on("Data",e=>{n.clientKey.verify(e.encSerObj,e.sig)&&"Open"===n.state&&(Object(u.a)(e.encSerObj,n.aesKey,e.ivHex),n.count?(new Date).getTime()-n.start>1e3&&!n.finished&&(console.log(n.count),n.finished=!0):(n.count=0,n.start=(new Date).getTime()),n.count+=1)})})})(l,u.d,u.e),l.listen(b,()=>console.log("Node/express server started on port "+b))},7:function(e,t,n){"use strict";n.d(t,"a",function(){return o});let{web3:a,DHTContract:s,accounts:r}=n(8);const o=class{constructor(e=s,t=r[0]){this.instance=e,this.sender=t}startOnboard(e,t,n,a,s,r=null){return r=r||this.sender,this.instance.methods.startOnboard(inputBytes,inputSig).send({from:r,value:e,gas:5e6})}finalizeOnboard(e=null){return e=e||this.sender,this.instance.methods.finalizeOnboard().send({from:e,gas:5e6})}safeOffboard(e=null){return e=e||this.sender,this.instance.methods.safeOffboard().send({from:e,gas:5e6})}beginOffboardVote(e,t=null){return t=t||this.sender,this.instance.methods.beginOffboardVote(e).send({from:t,gas:5e6})}offboardVote(e,t,n=null){return n=n||this.sender,this.instance.methods.offboardVote(e,t).send({from:n,gas:5e6})}finalizeOffboardVote(e,t=null){return t=t||this.sender,this.instance.methods.finalizeOffboardVote(e).send({from:t,gas:5e6})}getNodeState(e,t=null){return t=t||this.sender,this.instance.methods.getNodeState(e).call({from:t})}getNodeAddressByIndex(e,t=null){return t=t||this.sender,this.instance.methods.getNodeAddressByIndex(e).call({from:t})}getNumNodes(e=null){return e=e||this.sender,this.instance.methods.getNumNodes().call({from:e})}}()},8:function(e,t,n){const a=n(9),s=new a(new a.providers.HttpProvider("http://localhost:8545")),r=n(10),o=JSON.parse(JSON.stringify(n(11)));let i=new s.eth.Contract(o,r.DHTAddress),d=r.ganacheAccounts;e.exports={web3:s,DHTContract:i,accounts:d}},9:function(e,t){e.exports=require("web3")}});